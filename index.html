<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐播放器</title>

    <style>
        @font-face {
            font-family: 'CustomFont';
            src: url('SuXinShiGuYinSongJian-1.ttf') format('truetype');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000;
            font-family: 'CustomFont', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .player-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .music-title {
            font-size: 10vw;
            cursor: pointer;
            text-align: center;
            padding: 3%;
            transition: opacity 0.3s;
            user-select: none;
            width: 90%;
            word-wrap: break-word;
            line-height: 1.2;
            font-weight: normal;
        }

        .music-title:hover {
            opacity: 0.8;
        }

        .music-lyric {
            margin-top: 1vh;
            text-align: center;
            font-size: 4vw;
            opacity: 0.85;
            user-select: none;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 90%;
            line-height: 1.4;
        }

        .buttons {
            position: absolute;
            bottom: 20px;
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        button {
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        button:hover {
            background-color: rgba(255, 255, 255, 0.5);
        }

        @media (orientation: portrait) {
            .player-container {
                transform: rotate(90deg);
                transform-origin: left top;
                width: 100vh;
                height: 100vw;
                position: absolute;
                top: 0;
                left: 0;
            }

            .music-title {
                font-size: 10vh;
                transform: rotate(-90deg);
            }

            .music-lyric {
                font-size: 4vh;
                transform: rotate(-90deg);
            }
        }

        @media (hover: hover) {
            .player-container:hover .buttons {
                opacity: 1;
            }
        }
    </style>
</head>

<body>
<div class="player-container">
    <div class="music-title" id="title">加载中...</div>
    <div class="music-lyric" id="lyric"></div>

    <div class="buttons">
        <button id="prev">◀</button>
        <button id="next">▶</button>
    </div>

    <audio id="audio-player" style="display:none;"></audio>
</div>

<script>
    const musicList = [
        {
            title: "弱水三千",
            src: "music/003.mp3",
            lrc: "lrc/003.lrc",
            color: "#DC143C"
        },
		{
            title: "东南苦行山",
            src: "music/001.mp3",
            lrc: "lrc/001.lrc",
            color: "#3357FF"
        },
        {
            title: "牵丝戏",
            src: "music/002.mp3",
            lrc: "lrc/002.lrc",
            color: "#DC143C"
        },
        {
            title: "辞九门回忆",
            src: "music/004.mp3",
            lrc: "lrc/004.lrc",
            color: "#DC143C"
        },
        {
            title: "鸳鸯戏",
            src: "music/005.mp3",
            lrc: "lrc/005.lrc",
            color: "#DC143C"
        },
        {
            title: "唐人恋曲",
            src: "music/006.mp3",
            lrc: "lrc/006.lrc",
            color: "#DC143C"
        },
        {
            title: "半壶纱",
            src: "music/007.mp3",
            lrc: "lrc/007.lrc",
            color: "#DC143C"
        },
        {
            title: "关山酒",
            src: "music/008.mp3",
            lrc: "lrc/008.lrc",
            color: "#DC143C"
        },
        {
            title: "春庭雪",
            src: "music/009.mp3",
            lrc: "lrc/009.lrc",
            color: "#DC143C"
        },
        {
            title: "赐我",
            src: "music/010.mp3",
            lrc: "lrc/010.lrc",
            color: "#DC143C"
        },
        {
            title: "精卫",
            src: "music/011.mp3",
            lrc: "lrc/011.lrc",
            color: "#DC143C"
        },
        {
            title: "折风渡夜",
            src: "music/012.mp3",
            lrc: "lrc/012.lrc",
            color: "#DC143C"
        }
    ];

    let currentIndex = 0;
    let lyrics = [];

    const audioPlayer = document.getElementById('audio-player');
    const titleElement = document.getElementById('title');
    const lyricElement = document.getElementById('lyric');
    const prevButton = document.getElementById('prev');
    const nextButton = document.getElementById('next');

    async function loadLyrics(path) {
		lyrics = [];
		lyricElement.textContent = '';

		if (!path) return;

		try {
			const res = await fetch(path);
			const text = await res.text();

			const lines = text.split(/\r?\n/);
			const timeReg = /^\[(\d+):(\d+\.?\d*)](.*)$/;

			lines.forEach(line => {
				const match = line.match(timeReg);
				if (!match) return;

				const minutes = parseInt(match[1], 10);
				const seconds = parseFloat(match[2]);
				const content = match[3].trim();

				// ★ 关键：忽略空歌词行
				if (!content) return;

				lyrics.push({
					time: minutes * 60 + seconds,
					content
				});
			});

			lyrics.sort((a, b) => a.time - b.time);

			// 调试用（可保留）
			console.log('已解析歌词行数:', lyrics.length);
		} catch (e) {
			console.error('歌词加载失败:', e);
		}
	}

    async function loadMusic(index, autoPlay = true) {
        if (index < 0 || index >= musicList.length) return;
        const music = musicList[index];

        audioPlayer.src = music.src;
        titleElement.textContent = music.title;
        document.title = music.title + " - 音乐播放器";

        titleElement.style.color = music.color || '#fff';
        lyricElement.style.color = music.color || '#fff';

        await loadLyrics(music.lrc);

        if (autoPlay) {
            audioPlayer.play().catch(() => {});
        }
    }

    audioPlayer.addEventListener('timeupdate', () => {
    if (!lyrics.length) return;

    const currentTime = audioPlayer.currentTime;

    for (let i = lyrics.length - 1; i >= 0; i--) {
        if (currentTime >= lyrics[i].time) {
            if (lyricElement.textContent !== lyrics[i].content) {
                lyricElement.textContent = lyrics[i].content;
            }
            break;
        }
    }
});

    function togglePlayPause() {
        audioPlayer.paused ? audioPlayer.play() : audioPlayer.pause();
    }

    function playNext() {
        currentIndex = (currentIndex + 1) % musicList.length;
        loadMusic(currentIndex, true);
    }

    function playPrev() {
        currentIndex = (currentIndex - 1 + musicList.length) % musicList.length;
        loadMusic(currentIndex, true);
    }

    titleElement.addEventListener('click', togglePlayPause);
    prevButton.addEventListener('click', playPrev);
    nextButton.addEventListener('click', playNext);
    audioPlayer.addEventListener('ended', playNext);

    document.addEventListener('keydown', e => {
        if (e.key === ' ') {
            e.preventDefault();
            togglePlayPause();
        } else if (e.key === 'ArrowLeft') {
            playPrev();
        } else if (e.key === 'ArrowRight') {
            playNext();
        }
    });

    window.addEventListener('DOMContentLoaded', () => loadMusic(0, true));
</script>
</body>
</html>
